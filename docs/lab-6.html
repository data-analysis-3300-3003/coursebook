<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>coursebook - 14&nbsp; Introduction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./lab-6-self-guided.html" rel="next">
<link href="./lab-5-self-guided.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Introduction</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">coursebook</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./unit-overview.html" class="sidebar-item-text sidebar-link">Unit overview</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./software.html" class="sidebar-item-text sidebar-link">Software</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./readings.html" class="sidebar-item-text sidebar-link">Reading</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab-1.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab-1-practice-exercises.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 1 (practice)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab-2.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab-2-self-guided.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 2 (self-guided)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab-2-practice-exercises.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 2 (practice)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab-3.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 3</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab-3-self-guided.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 3 (self-guided)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab-3-practice-exercises.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 3 (practice)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab-4.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 4</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab-4-self-guided.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 4 (self-guided)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab-4-practice-exercises.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 4 (practice)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab-5.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 5</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab-5-self-guided.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 5 (self-guided)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab-6.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Week 6</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab-6-self-guided.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 6 (self-guided)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab-6-practice-exercises.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 6 (practice)</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#client-server-architectures" id="toc-client-server-architectures" class="nav-link active" data-scroll-target="#client-server-architectures">Client-server architectures</a>
  <ul class="collapse">
  <li><a href="#task" id="toc-task" class="nav-link" data-scroll-target="#task">Task</a></li>
  </ul></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a>
  <ul class="collapse">
  <li><a href="#run-the-labs" id="toc-run-the-labs" class="nav-link" data-scroll-target="#run-the-labs">Run the labs</a></li>
  <li><a href="#download-data" id="toc-download-data" class="nav-link" data-scroll-target="#download-data">Download data</a></li>
  <li><a href="#working-in-colab" id="toc-working-in-colab" class="nav-link" data-scroll-target="#working-in-colab">Working in Colab</a></li>
  <li><a href="#import-modules" id="toc-import-modules" class="nav-link" data-scroll-target="#import-modules">Import modules</a></li>
  </ul></li>
  <li><a href="#http" id="toc-http" class="nav-link" data-scroll-target="#http">HTTP</a>
  <ul class="collapse">
  <li><a href="#http-methods" id="toc-http-methods" class="nav-link" data-scroll-target="#http-methods">HTTP methods</a></li>
  </ul></li>
  <li><a href="#web-apis" id="toc-web-apis" class="nav-link" data-scroll-target="#web-apis">Web APIs</a>
  <ul class="collapse">
  <li><a href="#application-programming-interfaces" id="toc-application-programming-interfaces" class="nav-link" data-scroll-target="#application-programming-interfaces">Application programming interfaces</a></li>
  <li><a href="#recap-quiz-2" id="toc-recap-quiz-2" class="nav-link" data-scroll-target="#recap-quiz-2">Recap quiz</a></li>
  </ul></li>
  <li><a href="#building-a-weather-data-app" id="toc-building-a-weather-data-app" class="nav-link" data-scroll-target="#building-a-weather-data-app">Building a weather data app</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-title">Introduction</span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="client-server-architectures" class="level2">
<h2 class="anchored" data-anchor-id="client-server-architectures">Client-server architectures</h2>
<p>The client-server architecture is a model for describing computer-to-computer communication. Much of the internet, and web-enabled applications, utilise the client-server model for data exchange. For example, a client application such as your web browser can request data from a server (e.g.&nbsp;the data required to render the web page on your display). If the client’s request is valid, the server will respond by sending the requested data to the client. This model of clients sending a request and servers responding with data is at the heart of the client-server protocol.</p>
<p>This is a schematic from MDN Web Docs that illustrates how a client, here a web browser, requests data from various servers to build a web page on the client’s display. When the servers have processed the client’s requests, the arrows depicting data flow on the diagram below will reverse and the servers will respond by sending the requested data to the client.</p>
<p><img src="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview/fetching_a_page.png" class="img-fluid"></p>
<p><em>Attributions and copyright licensing by <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview/fetching_a_page.png" target="_blank">Mozilla Contributors</a> is licensed under CC-BY-SA 2.5.</em></p>
<p>Perhaps the most common example of client-server computing is web browsers requesting data from servers to render web pages. However, many applications can act as clients. For example, two servers in the cloud could communicate in a client-server manner with an application on one server requesting data from another. Or, various sensors (e.g.&nbsp;weather stations) could act as clients and post data to a server as new measurements are taken. They key point is that client-server computing describes a way that two applications can communicate over a network and share data.</p>
<p>If you open up Google Chrome and then go <strong>View</strong> → <strong>Developer</strong> → <strong>Developer Tools</strong> and head to https://www.openstreetmap.org/ you can see your browser making requests to OpenStreetMap and rendering the responses (PNG files among other data) on a web map (you can also try this for other websites and see if you can spot data sent by the server to your browswer which is then rendered on the display).</p>
<p>Make sure you have the <strong>Network</strong> tab selected and are viewing <strong>All</strong> messages. You can click on a message to see its structure and the data transferred.</p>
<p><img src="https://github.com/data-analysis-3300-3003/figs/raw/main/week-6-developer-tools.jpg" class="img-fluid"></p>
<p><img src="https://github.com/data-analysis-3300-3003/figs/raw/main/week-6-developer-tools-2.png" class="img-fluid"></p>
<section id="task" class="level3">
<h3 class="anchored" data-anchor-id="task">Task</h3>
<p>The tasks for this lab are i) to generate requests and process responses that scrape data from DPIRD’s Agriculture and Food website, and ii) to develop a small weather data application for a field in Western Australia based on a client-server model. The client will make requests for weather data to a server which will respond with weather data matching parameters set out in the request. The client will the visualise this weather data.</p>
</section>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<section id="run-the-labs" class="level3">
<h3 class="anchored" data-anchor-id="run-the-labs">Run the labs</h3>
<p>You can run the labs locally on your machine or you can use cloud environments provided by Google Colab. <strong>If you’re working with Google Colab be aware that your sessions are temporary and you’ll need to take care to save, backup, and download your work.</strong></p>
<p><a href="https://colab.research.google.com/github/data-analysis-3300-3003/colab/blob/main/lab-6.ipynb" target="_blank"> <img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"> </a></p>
</section>
<section id="download-data" class="level3">
<h3 class="anchored" data-anchor-id="download-data">Download data</h3>
<p>If you need to download the date for this lab, run the following code snippet.</p>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"week-6"</span> <span class="kw">not</span> <span class="kw">in</span> os.listdir(os.getcwd()):</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    os.system(<span class="st">'wget "https://github.com/data-analysis-3300-3003/data/raw/main/data/week-6.zip"'</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    os.system(<span class="st">'unzip "week-6.zip"'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="working-in-colab" class="level3">
<h3 class="anchored" data-anchor-id="working-in-colab">Working in Colab</h3>
<p>If you’re working in Google Colab, you’ll need to install the required packages that don’t come with the colab environment.</p>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'google.colab'</span> <span class="kw">in</span> <span class="bu">str</span>(get_ipython()):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>pip install geopandas</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>pip install pyarrow</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>pip install mapclassify</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>pip install rasterio</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>pip install skimage</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="import-modules" class="level3">
<h3 class="anchored" data-anchor-id="import-modules">Import modules</h3>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.io <span class="im">as</span> pio</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> skimage <span class="im">import</span> io</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># setup renderer</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'google.colab'</span> <span class="kw">in</span> <span class="bu">str</span>(get_ipython()):</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    pio.renderers.default <span class="op">=</span> <span class="st">"colab"</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    pio.renderers.default <span class="op">=</span> <span class="st">"jupyterlab"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="http" class="level2">
<h2 class="anchored" data-anchor-id="http">HTTP</h2>
<p>Hypertext transfer protocol (HTTP) is the protocol that describes how messages are exchanged between clients and servers.</p>
<p>To send messages via HTTP a connection between the client and the server needs to be created. HTTP messages are sent over a <a href="https://developer.mozilla.org/en-US/docs/Glossary/TCP" target="_blank">transmission control protocol (TCP)</a> connection. TCP connections are used to send HTTP messages as they ensure that all data sent is delivered in the right order (i.e.&nbsp;data transfer between clients and servers is error free).</p>
<p>Once the connection is created, the client sends a HTTP message to the server over the connection. The server responds with a HTTP message sent back to the client. Then, the connection is closed or reused for subsequent requests.</p>
<p>HTTP messages have a well-defined structure. <strong>Request</strong> messages start by specifying the HTTP method, then the path to the server or resource they are making a request to, followed by the HTTP version of the message. The path can be a complete <a href="https://developer.mozilla.org/en-US/docs/Glossary/URL" target="_blank">URL</a>; for example, to request the data to render the coursebook in your browser you need to send a request to <code>https://data-analysis-3300-3003.github.io/coursebook</code>.</p>
<p>After the line denoting the HTTP method, path, and version, <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers" target="_blank">HTTP headers</a> are specified. This is extra information that is provided to the server to help handle the request (e.g.&nbsp;you could put credentials for authentication here or descriptions of data included in the body). HTTP headers comprise a name and a value separated by a colon <code>:</code>. The following headers are used to describe data in the body of a request message:</p>
<ul>
<li><code>Content-Length: &lt;size of data in body of HTTP message - decimal number of bytes&gt;</code></li>
<li><code>Content-Type: &lt;type of data in body of HTTP message&gt;</code></li>
<li><code>Content-Encoding: &lt;compression algorithm used to compress data in body&gt;</code></li>
</ul>
<p>These are examples of headers used to pass credentials to the server for authenticated access to server resources (e.g.&nbsp;if you are sending a username and password to the server).</p>
<ul>
<li><code>Authorization: &lt;authentication scheme&gt; &lt;credentials&gt;</code></li>
</ul>
<p>The HTTP Basic authentication scheme sends username and password combinations as base64 encoded data <strong>(note, this is not encrypted and just text data encoded in a different format. So, this is not secure unless sent over an encrypted connection - you can see if your connection is encrypted as the url will start with https (and not http)).</strong> If our username is <code>testuser</code> and our password is <code>testpassword</code> we’d include our credentials in a HTTP message header as:</p>
<p><code>Authorization: Basic dGVzdHVzZXI6dGVzdHBhc3N3b3Jk</code></p>
<p><code>dGVzdHVzZXI6dGVzdHBhc3N3b3Jk</code> is the base64 encoding of <code>testuser:testpassword</code>.</p>
<p>Finally, data can be included in the request body. If you are POSTing data to a server, such as an image in PNG format or text as JSON data, this is where that data would go.</p>
<p><img src="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview/http_request.png" class="img-fluid"></p>
<p><em>Attributions and copyright licensing by <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview/http_request.png" target="_blank">Mozilla Contributors</a> is licensed under CC-BY-SA 2.5.</em></p>
<p>Once the server has received and processed a client’s request, it sends a <strong>response</strong> message. Similar to the request message format, the HTTP response includes the version of the HTTP protocol, a status code indicating if the request was successful or failed, HTTP headers which provide information for the client to process the response, and a body containing data the client requested.</p>
<p>It is important to be aware of HTTP response status codes to identify if your request to a server was successful or if there was an error that you’ll need to address. A HTTP response status code greater than or equal to 400 indicates an error occurred and the request could not be processed. You can read up on the range of status codes <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status" target="_blank">here</a>.</p>
<p><img src="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview/http_response.png" class="img-fluid"></p>
<p><em>Attributions and copyright licensing by <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview/http_response.png" target="_blank">Mozilla Contributors</a> is licensed under CC-BY-SA 2.5.</em></p>
<section id="http-methods" class="level3">
<h3 class="anchored" data-anchor-id="http-methods">HTTP methods</h3>
<p>HTTP request messages start with a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods" target="_blank">HTTP method</a>. These indicate how the server should handle the client’s request. Some of the commonly used HTTP methods are listed below:</p>
<ul>
<li><code>GET</code>: request a specified resource or data.</li>
<li><code>POST</code>: post data to the server.</li>
<li><code>DELETE</code>: delete the specified resource or data on the server.</li>
<li><code>PUT</code>: replace the specified resource or data on the server.</li>
</ul>
<p>Generally, we don’t need to write HTTP messages manually but software applications do this for us. Commonly, this is done by your web browswer or apps on your smartphone. When we’re working in Python we can use the <a href="https://requests.readthedocs.io/en/latest/user/quickstart/" target="_blank">requests</a> package to make and handle HTTP requests and responses.</p>
<p>The requests package has a <code>requests</code> object with methods for each of the HTTP methods. You can see the docs for the <code>requests</code> object <a href="https://requests.readthedocs.io/en/latest/api/#requests.request" target="_blank">here</a>. The general pattern for using a <code>requests</code> object method is:</p>
<p><code>r = requests.&lt;http method&gt;(&lt;url&gt;)</code></p>
<p>where <code>r</code> is a response object from the server. For example, we can make a request to get image data that is rendered on DPIRD’s Agriculture and Food website under their <a href="https://www.agric.wa.gov.au/dry-seasons-and-drought/seasonal-climate-information" target="_blank">seasonal climate information</a> tool. We pass in the url to where the image is located on a server to the <code>get</code> method. The server returns to us a response object referenced by <code>r</code>. Let’s start by downloading some of the images of potential yield maps.</p>
<p>To get the url for an image, you can navigate to their website, right click on the image, and copy image address.</p>
<p><img src="https://github.com/data-analysis-3300-3003/figs/raw/main/week-6-dpird-agric-copy-image-address.png" class="img-fluid"></p>
<section id="get-requests" class="level4">
<h4 class="anchored" data-anchor-id="get-requests">GET requests</h4>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">"https://www.agric.wa.gov.au/iaagseasons/yield/2022/Oct2022/maps/wue12_evap90_dec3.png"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>&lt;Response [200]&gt;</code></pre>
</div>
</div>
<p>The call to <code>requests.get("https://www.agric.wa.gov.au/iaagseasons/yield/2022/Oct2022/maps/wue12_evap90_dec3.png")</code> creates a HTTP request message and sends it to the specified URL.</p>
<p>The <code>response</code> object <code>r</code> has a <code>status_code</code> property that tells us if our request was successful or not.</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>r.status_code</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>200</code></pre>
</div>
</div>
<p>We can also access the HTTP response message’s body where the requested data is stored via the <code>content</code> property. Let’s print the first 100 bytes of data requested from the server.</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>r.content[<span class="dv">0</span>:<span class="dv">100</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x03W\x00\x00\x02\xd0\x08\x02\x00\x00\x00\xf3b\x1ds\x00\x00 \x00IDATx\x9c\xec\x9dg\\\x13Y\xd7\xc0O*\xa1\x84*\x1diRTP\x9aXA\x11\xc5\x86\xae\xba\x8a\xbd\x17\xd0}\xack[]\x0b\xee\xda\xfb\xba\xf6\xde{\xd9U,XQ\x11,\x08\xa2R\xa4\nRC'</code></pre>
</div>
</div>
<p>As the data we have requested is image data, it has been sent to us as binary data and not text. We can see this by the <code>b</code> before the string representation of the data printed on our display. We can see that the data we’ve requested corresponds to a PNG image by the PNG header in the data printed on the display.</p>
<p>The data for the PNG file we requested is currently stored as bytes in memory and referenced by the <code>content</code> property of the response object <code>r</code>. Let’s save this data to disk.</p>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(os.path.join(os.getcwd(), <span class="st">"week-6"</span>, <span class="st">"wue12_evap90_dec3.png"</span>), <span class="st">"wb"</span>) <span class="im">as</span> dst:</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    dst.write(r.content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s check it saved OK.</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> io.imread(os.path.join(os.getcwd(), <span class="st">"week-6"</span>, <span class="st">"wue12_evap90_dec3.png"</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>px.imshow(img, height<span class="op">=</span><span class="dv">600</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab-6_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>If we inspect the url for the potential yield image we downloaded, we can see that it corresponds to a set of water use efficiency, evaporation, and growing season rainfall decile values. We can also check this by looking at the <a href="https://www.agric.wa.gov.au/dry-seasons-and-drought/seasonal-climate-information" target="_blank">seasonal climate information</a> tool and seeing what options are available to us in the drop-down list.</p>
<p><img src="https://github.com/data-analysis-3300-3003/figs/raw/main/week-6-dpird-agric-potential-yield-options.png" class="img-fluid"></p>
<p>We can create a small routine to loop over combinations of water use efficiency, evaporation, and growing season rainfall decile values to automate the process of downloading potential yield maps. This is a simple example of web scraping - the process of extracting data from web pages. We’re not restricted to downloading images, it’s also possible to get text data from web pages too. This can be useful if there is information we require for our analysis on web pages that we cannot download in easier to use formats (e.g.&nbsp;CSV files).</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>wue <span class="op">=</span> [<span class="dv">12</span>, <span class="dv">15</span>]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>evap <span class="op">=</span> [<span class="dv">90</span>, <span class="dv">110</span>]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>decile <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> w <span class="kw">in</span> wue:</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> e <span class="kw">in</span> evap:</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> d <span class="kw">in</span> decile:</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>            <span class="co"># download each image corresponding to wue, evap, rainfall decile combination</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>            r <span class="op">=</span> requests.get(<span class="ss">f"https://www.agric.wa.gov.au/iaagseasons/yield/2022/Oct2022/maps/wue</span><span class="sc">{</span>w<span class="sc">}</span><span class="ss">_evap</span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">_dec</span><span class="sc">{</span>d<span class="sc">}</span><span class="ss">.png"</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>            <span class="co"># save image files</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(os.path.join(os.getcwd(), <span class="st">"week-6"</span>, <span class="ss">f"wue</span><span class="sc">{</span>w<span class="sc">}</span><span class="ss">_evap</span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">_dec</span><span class="sc">{</span>d<span class="sc">}</span><span class="ss">.png"</span>), <span class="st">"wb"</span>) <span class="im">as</span> dst:</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                dst.write(r.content)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># check to see if the files have downloaded</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(os.listdir(os.path.join(os.getcwd(), <span class="st">"week-6"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['.DS_Store', '.ipynb_checkpoints', 'BF66_bdy.dbf', 'BF66_bdy.geojson', 'BF66_bdy.prj', 'BF66_bdy.shp', 'BF66_bdy.shx', 'wue12_evap110_dec3.png', 'wue12_evap110_dec5.png', 'wue12_evap110_dec7.png', 'wue12_evap90_dec3.png', 'wue12_evap90_dec5.png', 'wue12_evap90_dec7.png', 'wue15_evap110_dec3.png', 'wue15_evap110_dec5.png', 'wue15_evap110_dec7.png', 'wue15_evap90_dec3.png', 'wue15_evap90_dec5.png', 'wue15_evap90_dec7.png']</code></pre>
</div>
</div>
<p>Look at the url pattern describing where images are stored on the <a href="www.agric.wa.gov.au" target="_blank">agric.wa.gov.au</a> servers. You should see some logic in how the images are arranged by year and month.</p>
</section>
<section id="recap-quiz" class="level4">
<h4 class="anchored" data-anchor-id="recap-quiz">Recap quiz</h4>
<p><strong>Can you extend the above routine to iterate over different years (choose 2021 and 2022) and months (choose Sept, Oct, and Nov) and print out the status code for each response to indicate whether the requested resource (a potential yield image) exists on the server?</strong></p>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">## ADD CODE HERE ##</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<details>
<summary>
<b>answer</b>
</summary>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>wue <span class="op">=</span> [<span class="dv">12</span>, <span class="dv">15</span>]</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>evap <span class="op">=</span> [<span class="dv">90</span>, <span class="dv">110</span>]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>decile <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>]</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>month <span class="op">=</span> [<span class="st">"Sept"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>year <span class="op">=</span> [<span class="dv">2021</span>, <span class="dv">2022</span>]</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> y <span class="kw">in</span> year:</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m <span class="kw">in</span> month:</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> w <span class="kw">in</span> wue:</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> e <span class="kw">in</span> evap:</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> d <span class="kw">in</span> decile:</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># download each image corresponding to wue, evap, rainfall decile combination</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>                    r <span class="op">=</span> requests.get(<span class="ss">f"https://www.agric.wa.gov.au/iaagseasons/yield/</span><span class="sc">{</span>y<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>m<span class="sc">}{</span>y<span class="sc">}</span><span class="ss">/maps/wue</span><span class="sc">{</span>w<span class="sc">}</span><span class="ss">_evap</span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">_dec</span><span class="sc">{</span>d<span class="sc">}</span><span class="ss">.png"</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"downloading image for year </span><span class="sc">{</span>y<span class="sc">}</span><span class="ss">, month </span><span class="sc">{</span>m<span class="sc">}</span><span class="ss">, wue </span><span class="sc">{</span>w<span class="sc">}</span><span class="ss">, evap </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">, and decile </span><span class="sc">{</span>d<span class="sc">}</span><span class="ss"> had status </span><span class="sc">{</span>r<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>
</p>
<p><strong>Can you download and visualise images of maps of frost risk from the <a href="https://www.agric.wa.gov.au/dry-seasons-and-drought/seasonal-climate-information" target="_blank">seasonal climate information</a> tool?</strong></p>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">## ADD CODE HERE ##</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<details>
<summary>
<b>answer</b>
</summary>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="ss">f"https://www.agric.wa.gov.au/iaagseasons/frost/Jul_1975-2022_frost.png"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># save image files</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(os.path.join(os.getcwd(), <span class="st">"week-6"</span>, <span class="ss">f"Jul_1975-2022_frost.png"</span>), <span class="st">"wb"</span>) <span class="im">as</span> dst:</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    dst.write(r.content)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>frost_img <span class="op">=</span> io.imread(os.path.join(os.getcwd(), <span class="st">"week-6"</span>, <span class="ss">f"Jul_1975-2022_frost.png"</span>))</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>px.imshow(frost_img, height<span class="op">=</span><span class="dv">600</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>
</p>
</section>
<section id="post-requests" class="level4">
<h4 class="anchored" data-anchor-id="post-requests">POST requests</h4>
<p>We can use <a href="https://httpbin.org/#/" target="_blank">httpbin</a> to practice sending HTTP requests to a server. It has endpoints that allow us to send demo requests using HTTP methods, authentication types, and request different data resources from servers.</p>
<p>So far we have been using HTTP GET requests to retrieve data from the server hosting the <a href="https://www.agric.wa.gov.au/dry-seasons-and-drought/seasonal-climate-information" target="_blank">seasonal climate information</a> website. However, there are many instances when we want to send data to the server as part of our request. A common case of sending data to a server is when we fill out and submit a form on a website. However, there are many cases where we need to send data to a server; for example, if the server responds with a satellite image we might need to send a polygon geometry in the request to tell the server which area of the Earth’s surface we want a satellite image for.</p>
<p>The data in a POST request is included in the request message’s body. Let’s demo sending some POST requests to httpbin. The url for httpbin’s POST endpoint is <code>https://httpbin.org/post</code>.</p>
<p>The <code>requests</code> object has a <code>post()</code> method that we can use to create POST requests.</p>
<p>To send files in the body of the POST message, we can use the <code>files</code> parameter of the <code>post()</code> method. The <code>files</code> parameter takes a dictionary of files as it’s argument. Inside the <code>week-6</code> directory is a <code>BF66_bdy.geojson</code> file - this is the GeoJSON representation for a field boundary in Western Australia. Let’s send this file to httpbin in a POST request.</p>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>path_to_file <span class="op">=</span> os.path.join(os.getcwd(), <span class="st">"week-6"</span>, <span class="st">"BF66_bdy.geojson"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>files_to_send <span class="op">=</span> {<span class="st">"file_1"</span>: <span class="bu">open</span>(path_to_file, <span class="st">"r"</span>)}</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.post(<span class="st">"https://httpbin.org/post"</span>, files<span class="op">=</span>files_to_send)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check request was successful</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>r.status_code</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>200</code></pre>
</div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect the data that was POSTed - it should print an (ugly) list of coordinates</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># here we only print the first 2000 characters</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>r.text[<span class="dv">0</span>:<span class="dv">2000</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>'{\n  "args": {}, \n  "data": "", \n  "files": {\n    "file_1": "{\\n\\"type\\": \\"FeatureCollection\\",\\n\\"crs\\": { \\"type\\": \\"name\\", \\"properties\\": { \\"name\\": \\"urn:ogc:def:crs:OGC:1.3:CRS84\\" } },\\n\\"features\\": [\\n{ \\"type\\": \\"Feature\\", \\"properties\\": { \\"NAME\\": \\"BF 66\\", \\"LAYER\\": \\"Field Boundary&lt;BR/&gt;&lt;a href=\\\\\\"http://www.pct-ag.com\\\\\\"&gt;www.pct-ag.com&lt;/a&gt;\\", \\"GM_TYPE\\": \\"Unknown Area Type\\", \\"_a_href\\": \\"\\\\\\"http://www.pct-ag.com\\\\\\"&gt;www.pct-ag.com&lt;/a&gt;\\", \\"KML_FOLDER\\": \\"Field Boundary\\", \\"tessellate\\": \\"true\\" }, \\"geometry\\": { \\"type\\": \\"Polygon\\", \\"coordinates\\": [ [ [ 117.489151504115, -31.591369180296699 ], [ 117.489499470536998, -31.591394914441501 ], [ 117.489615365014004, -31.5913854481526 ], [ 117.489615459383998, -31.591403492278701 ], [ 117.489657619992002, -31.591403330715899 ], [ 117.489678605913994, -31.591385205803402 ], [ 117.489731259467007, -31.591375981758699 ], [ 117.489973635661997, -31.591366030301099 ], [ 117.492492777704001, -31.591365367516399 ], [ 117.492935748728001, -31.591417792797799 ], [ 117.493030752604994, -31.591444492971899 ], [ 117.493515409295, -31.591406532967401 ], [ 117.493610127899004, -31.591379100363199 ], [ 117.494474419547998, -31.591375758527199 ], [ 117.495064762840997, -31.5913915170498 ], [ 117.495127908260002, -31.591373227892198 ], [ 117.496434885436997, -31.5913681565962 ], [ 117.496645783901002, -31.591385381500299 ], [ 117.497035721122003, -31.5913748430042 ], [ 117.498026589895005, -31.591389029170401 ], [ 117.498838132304996, -31.591376841169001 ], [ 117.499344154973002, -31.591392909081399 ], [ 117.501167549759998, -31.591376747900998 ], [ 117.501536599318001, -31.5914023665439 ], [ 117.502021445406001, -31.591400462497099 ], [ 117.502295585639999, -31.5914174295743 ], [ 117.502590709364, -31.5914162690549 ], [ 117.502759448388005, -31.591433649685001 ], [ 117.502865043577998, -31.5914693230885 ], [ 117.50301328418, -31.591595050878901 ], [ 117.503024066720002, -31.591640119606001 ], [ 117.5'</code></pre>
</div>
</div>
</section>
<section id="recap-quiz-1" class="level4">
<h4 class="anchored" data-anchor-id="recap-quiz-1">Recap quiz</h4>
<p><strong>GeoJSON data is a text representation of a geometry. A shapefile’s .shp file is binary.</strong></p>
<p><strong>Can you adapt the above code snippet to send a POST message with <code>BF66_bdy.shp</code> to httpbin’s POST endpoint?</strong></p>
<p><strong>If you get stuck head back to lab-2’s section on <em>Files in Python</em> and opening files in binary mode.</strong></p>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">## ADD CODE HERE ##</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<details>
<summary>
<b>answer</b>
</summary>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>path_to_file <span class="op">=</span> os.path.join(os.getcwd(), <span class="st">"week-6"</span>, <span class="st">"BF66_bdy.shp"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>files_to_send <span class="op">=</span> {<span class="st">"file_1"</span>: <span class="bu">open</span>(path_to_file, <span class="st">"rb"</span>)}</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.post(<span class="st">"https://httpbin.org/post"</span>, files<span class="op">=</span>files_to_send)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>r.status_code</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>We can also pass Python data structures into the body of a POST message. For example, the body of a POST message can include data with a key:value pair structure. We can store this data in a Python dictionary and then pass the dictionary into the <code>post()</code> method’s <code>data</code> parameter.</p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>demo_dict <span class="op">=</span> {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lon"</span>: <span class="op">-</span><span class="dv">118</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lat"</span>: <span class="op">-</span><span class="dv">30</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.post(<span class="st">"https://httpbin.org/post"</span>, data<span class="op">=</span>demo_dict)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>r.status_code</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>200</code></pre>
</div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the data that was POSTed to httpbin</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>r.text</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>'{\n  "args": {}, \n  "data": "", \n  "files": {}, \n  "form": {\n    "lat": "-30", \n    "lon": "-118"\n  }, \n  "headers": {\n    "Accept": "*/*", \n    "Accept-Encoding": "gzip, deflate, br", \n    "Content-Length": "16", \n    "Content-Type": "application/x-www-form-urlencoded", \n    "Host": "httpbin.org", \n    "User-Agent": "python-requests/2.28.1", \n    "X-Amzn-Trace-Id": "Root=1-6428e492-0f65a5f92c728992698ab329"\n  }, \n  "json": null, \n  "origin": "110.22.4.83", \n  "url": "https://httpbin.org/post"\n}\n'</code></pre>
</div>
</div>
<p>When we print the response message using <code>r.text</code> we are printing the text encoded version of the response. So, you can see other parts of the HTTP response message including the headers (e.g.&nbsp;we can see the <code>"Content-Length"</code> header which tells us the size of the data in the body of the response).</p>
<p>There are some other parameters we can set in <code>requests</code> object methods that are useful. We can use the <code>timeout</code> parameter to specify how many seconds we want to wait for the server to respond. You can see a list of these parameters <a href="https://requests.readthedocs.io/en/latest/api/#requests.request" target="_blank">here</a>.</p>
</section>
<section id="authentication" class="level4">
<h4 class="anchored" data-anchor-id="authentication">Authentication</h4>
<p>We can also use <code>requests</code> object method’s <code>auth</code> argument to pass in username and passwords for HTTP Basic authentication. httpbin has an endpoint to test making authenticated requests at: <code>"https://httpbin.org/basic-auth/username/password"</code>. You can read up on authentication <a href="https://httpbin.org/basic-auth/username/password" target="_blank">here</a>.</p>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">"https://httpbin.org/basic-auth/username/password"</span>, auth<span class="op">=</span>(<span class="st">"username"</span>, <span class="st">"password"</span>))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>r.status_code</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>200</code></pre>
</div>
</div>
<p>It is best practice to avoid storing usernames and passwords (i.e.&nbsp;credentials in Python code). You should set your username and password as <a href="https://docs.python.org/3/library/os.html?highlight=environ#os.environ" target="_blank">environment variables</a> on your system and then read them into your program as required.</p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set environment variables</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># you should do this outside your program's source code (e.g. on the Python console) or in a separate config file that you don't share</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">"user"</span>] <span class="op">=</span> <span class="st">"username"</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">"pwd"</span>] <span class="op">=</span> <span class="st">"password"</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># use environment variables in authenticated request</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">"https://httpbin.org/basic-auth/username/password"</span>, auth<span class="op">=</span>(os.environ[<span class="st">"user"</span>], os.environ[<span class="st">"pwd"</span>]))</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>r.status_code</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>200</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="web-apis" class="level2">
<h2 class="anchored" data-anchor-id="web-apis">Web APIs</h2>
<section id="application-programming-interfaces" class="level3">
<h3 class="anchored" data-anchor-id="application-programming-interfaces">Application programming interfaces</h3>
<p>An API is an application programming interface. An API provides is an interface between two applications that defines how they can communicate (i.e.&nbsp;one application can make requests to another application via its API and receive a response). API’s should be well-described, this allows client applications to make requests (or API calls) to use another application’s services via its API.</p>
<p>As an example, Plotly Express publishes its <a href="https://plotly.com/python-api-reference/plotly.express.html" target="_blank">API reference</a> which describes how you can access services provided by the Plotly package from within your Python programs (i.e.&nbsp;the Plotly Express API). The services provided by Plotly Express and accessed via its API are used to generate visualisations.</p>
<p>A web API is a web service provided by a web server and accessible via its API. For example, when we load a website our browser makes an API call to a server’s web API to request the data required to render the web page. We can see an example of web APIs on <a href="https://www.agric.wa.gov.au/weather-api-20" target="_blank">DPIRD’s Agriculture and Food website</a>; for example, the Weather API 2.0 defines a set of endpoints that can queried to retrieve information about weather stations and weather data.</p>
<p>The DPIRD Weather API 2.0 is published below (you can scroll down to see the various endpoints). The is a description of the interface to DPIRD servers which provide services for disseminating weather data based on client application requests. You can see that the endpoints match HTTP methods - we can make HTTP requests from within our programs to the DPIRD Weather API 2.0 to obtain weather data. You can click on each of the endpoints to see what kind of information needs to be passed into the web API by the client when making requests.</p>
<p>The DPIRD Weather API 2.0 is published using the swagger and the <a href="https://swagger.io/specification/" target="_blank">OpenAPI Specification</a> - a common format for describing web APIs.</p>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>HTML</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>iframe src<span class="op">=</span><span class="st">"https://api.dpird.wa.gov.au/v2/weather/openapi/"</span> width<span class="op">=</span><span class="st">"900px"</span> height<span class="op">=</span><span class="st">"800px"</span><span class="op">&gt;&lt;/</span>iframe<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<iframe src="https://api.dpird.wa.gov.au/v2/weather/openapi/" width="900px" height="800px"></iframe>
</div>
</div>
<p>The DPIRD Weather API 2.0 requires authentication and using an API key to access its services. Therefore, to practice making web API calls via HTTP requests we will work with <a href="https://open-meteo.com/" target="_blank">open-meteo’s</a> free weather API.</p>
<p>open-meteo’s historical weather API is documented <a href="https://open-meteo.com/en/docs/historical-weather-api" target="_blank">here</a>. When making an web API call we often need to send values that define how the server should process our request. We saw above how we can use POST requests to send data to a server. Another method of sending data to web APIs is via query parameters.</p>
<p>Query parameters are appended to the URL where the request is sent to as key:value pairs.</p>
<p>open-meteo’s web API is located at: <code>https://archive-api.open-meteo.com/v1/archive</code> - it is also embedded below.</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>HTML</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>iframe src<span class="op">=</span><span class="st">"https://open-meteo.com/en/docs/historical-weather-api"</span> width<span class="op">=</span><span class="st">"900px"</span> height<span class="op">=</span><span class="st">"900px"</span><span class="op">&gt;&lt;/</span>iframe<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<iframe src="https://open-meteo.com/en/docs/historical-weather-api" width="900px" height="900px"></iframe>
</div>
</div>
<p>To make a GET request to open-meteo’s API for: daily maximum temperature (at 2 m), the month of February 2023, and coordinates in Perth we’d use the following URL:</p>
<pre><code>https://archive-api.open-meteo.com/v1/archive?latitude=-31.9523&amp;longitude=115.8613&amp;start_date=2023-02-01&amp;end_date=2023-02-28&amp;daily=temperature_2m_max&amp;timezone=auto</code></pre>
<p>Can you spot after the URL for the API the <code>?</code> and then a series of key:value pairs describing our query with each key:value pair separated by <code>&amp;</code>. This the format for adding query parameters to a URL.</p>
<p>The <code>requests</code> object’s <code>get()</code> method in Python has a <code>params</code> argument that takes a dictionary of parameters and values and appends them to the URL as query parameters.</p>
<p>We can request temperature data for February 2023 over Perth as follows:</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>payload <span class="op">=</span> {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"latitude"</span>: <span class="op">-</span><span class="fl">31.9523</span>,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"longitude"</span>: <span class="fl">115.8613</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"start_date"</span>: <span class="st">"2023-02-01"</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"end_date"</span>: <span class="st">"2023-02-28"</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"daily"</span>: <span class="st">"temperature_2m_max"</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"timezone"</span>: <span class="st">"auto"</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">"https://archive-api.open-meteo.com/v1/archive"</span>, params<span class="op">=</span>payload)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>r.status_code</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>200</code></pre>
</div>
</div>
<p>We can print the response object from open-meteo’s API and verify that it has returned to us a month’s worth of daily maximum temperature values.</p>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>r.text</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>'{"latitude":-32.0,"longitude":115.899994,"generationtime_ms":0.5990266799926758,"utc_offset_seconds":28800,"timezone":"Australia/Perth","timezone_abbreviation":"AWST","elevation":23.0,"daily_units":{"time":"iso8601","temperature_2m_max":"°C"},"daily":{"time":["2023-02-01","2023-02-02","2023-02-03","2023-02-04","2023-02-05","2023-02-06","2023-02-07","2023-02-08","2023-02-09","2023-02-10","2023-02-11","2023-02-12","2023-02-13","2023-02-14","2023-02-15","2023-02-16","2023-02-17","2023-02-18","2023-02-19","2023-02-20","2023-02-21","2023-02-22","2023-02-23","2023-02-24","2023-02-25","2023-02-26","2023-02-27","2023-02-28"],"temperature_2m_max":[31.6,33.3,34.5,37.1,33.6,26.9,29.2,31.1,32.5,28.0,28.7,32.4,34.6,25.5,26.3,26.0,28.6,34.3,35.4,36.4,31.3,28.5,26.7,28.9,31.6,33.9,35.3,35.3]}}'</code></pre>
</div>
</div>
<p>The format of the response from open-meteo’s API should be familiar, it is JSON formatted data. When responses are returned to us as JSON we can use the <code>json()</code> method of the response object to access the data as a dictionary object. This makes it easier for us to work with data returned from the web API in our programs. For example, we could extract the date and temperature data and make them columns in a pandas <code>DataFrame</code>.</p>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>json_response <span class="op">=</span> r.json()</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"the type of json_response is </span><span class="sc">{</span><span class="bu">type</span>(json_response)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>the type of json_response is &lt;class 'dict'&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>json_response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>{'latitude': -32.0,
 'longitude': 115.899994,
 'generationtime_ms': 0.5990266799926758,
 'utc_offset_seconds': 28800,
 'timezone': 'Australia/Perth',
 'timezone_abbreviation': 'AWST',
 'elevation': 23.0,
 'daily_units': {'time': 'iso8601', 'temperature_2m_max': '°C'},
 'daily': {'time': ['2023-02-01',
   '2023-02-02',
   '2023-02-03',
   '2023-02-04',
   '2023-02-05',
   '2023-02-06',
   '2023-02-07',
   '2023-02-08',
   '2023-02-09',
   '2023-02-10',
   '2023-02-11',
   '2023-02-12',
   '2023-02-13',
   '2023-02-14',
   '2023-02-15',
   '2023-02-16',
   '2023-02-17',
   '2023-02-18',
   '2023-02-19',
   '2023-02-20',
   '2023-02-21',
   '2023-02-22',
   '2023-02-23',
   '2023-02-24',
   '2023-02-25',
   '2023-02-26',
   '2023-02-27',
   '2023-02-28'],
  'temperature_2m_max': [31.6,
   33.3,
   34.5,
   37.1,
   33.6,
   26.9,
   29.2,
   31.1,
   32.5,
   28.0,
   28.7,
   32.4,
   34.6,
   25.5,
   26.3,
   26.0,
   28.6,
   34.3,
   35.4,
   36.4,
   31.3,
   28.5,
   26.7,
   28.9,
   31.6,
   33.9,
   35.3,
   35.3]}}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>date <span class="op">=</span> json_response[<span class="st">"daily"</span>][<span class="st">"time"</span>]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>max_temp <span class="op">=</span> json_response[<span class="st">"daily"</span>][<span class="st">"temperature_2m_max"</span>]</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">"date"</span>: date, <span class="st">"max_temp"</span>: max_temp})</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>date</th>
      <th>max_temp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2023-02-01</td>
      <td>31.6</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2023-02-02</td>
      <td>33.3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2023-02-03</td>
      <td>34.5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2023-02-04</td>
      <td>37.1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2023-02-05</td>
      <td>33.6</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>px.line(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    df,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"date"</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"max_temp"</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"max_temp"</span>: <span class="st">"daily maximum T °C"</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>)     </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab-6_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="recap-quiz-2" class="level3">
<h3 class="anchored" data-anchor-id="recap-quiz-2">Recap quiz</h3>
<p><strong>Can you use the <a href="https://open-meteo.com/en/docs/historical-weather-api#api-documentation" target="_blank">open-meteo</a> API to get hourly temperature values for the month of January 2022?</strong></p>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">## ADD CODE HERE ##</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<details>
<summary>
<b>answer</b>
</summary>
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>payload <span class="op">=</span> {</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"latitude"</span>: <span class="op">-</span><span class="fl">31.9523</span>,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"longitude"</span>: <span class="fl">115.8613</span>,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"start_date"</span>: <span class="st">"2023-01-01"</span>, <span class="co"># note changing date</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"end_date"</span>: <span class="st">"2023-01-31"</span>, <span class="co"># note changing date</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"hourly"</span>: <span class="st">"temperature_2m"</span>, <span class="co"># note changing key and value</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"timezone"</span>: <span class="st">"auto"</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">"https://archive-api.open-meteo.com/v1/archive"</span>, params<span class="op">=</span>payload)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"response status code </span><span class="sc">{</span>r<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co"># extract json response and covert to DataFrame</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>json_response <span class="op">=</span> r.json()</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>hours <span class="op">=</span> json_response[<span class="st">"hourly"</span>][<span class="st">"time"</span>]  <span class="co"># note change in keys in response (hourly not daily)</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> json_response[<span class="st">"hourly"</span>][<span class="st">"temperature_2m"</span>]</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>df_hourly <span class="op">=</span> pd.DataFrame({<span class="st">"date_time"</span>: hours, <span class="st">"temp"</span>: temp})</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="co"># make hourly temperature chart for Jan 2023</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>px.line(</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>    df_hourly,</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"date_time"</span>,</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"temp"</span>,</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"temp"</span>: <span class="st">"T °C"</span>,</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date_time"</span>: <span class="st">"date and time"</span></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
</section>
<section id="building-a-weather-data-app" class="level2">
<h2 class="anchored" data-anchor-id="building-a-weather-data-app">Building a weather data app</h2>
<p>As a final activity, we’ll use open-meteo’s APIs to build a couple of simple weather data applications for a field in Western Australia. The first of the applications will make a series of requests to open-meteo’s API to retrieve growing season climate variables (June to October) and visualise trends in that variable over time. The second application will request a 7-day weather forecast for the field.</p>
<p>First, let’s load the field’s extent into our program and extract it’s centroid. We’ll need the centroid’s latitude and longitude values to pass to the open-meteo API as query parameters.</p>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>field_poly <span class="op">=</span> gpd.read_file(os.path.join(os.getcwd(), <span class="st">"week-6"</span>, <span class="st">"BF66_bdy.geojson"</span>))</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>field_centroid <span class="op">=</span> field_poly.geometry.centroid</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>longitude <span class="op">=</span> field_centroid.x</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>latitude <span class="op">=</span> field_centroid.y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_100/3108562045.py:2: UserWarning:

Geometry is in a geographic CRS. Results from 'centroid' are likely incorrect. Use 'GeoSeries.to_crs()' to re-project geometries to a projected CRS before this operation.

</code></pre>
</div>
</div>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> field_poly.explore()</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>field_centroid.explore(m<span class="op">=</span>m, color<span class="op">=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">

<div style="width:100%;"><div style="position:relative;width:100%;height:0;padding-bottom:60%;"><span style="color:#565656">Make this Notebook Trusted to load map: File -&gt; Trust Notebook</span><iframe srcdoc="<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; />
    
        <script>
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        </script>
    
    <style>html, body {width: 100%;height: 100%;margin: 0;padding: 0;}</style>
    <style>#map {position:absolute;top:0;bottom:0;right:0;left:0;}</style>
    <script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;></script>
    <script src=&quot;https://code.jquery.com/jquery-1.12.4.min.js&quot;></script>
    <script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;></script>
    <script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/>
    
            <meta name=&quot;viewport&quot; content=&quot;width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; />
            <style>
                #map_a4fdb0523e82af01d11dbb9a0f326a95 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>
        
    
                    <style>
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    </style>
            
    
                    <style>
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    </style>
            
</head>
<body>
    
    
            <div class=&quot;folium-map&quot; id=&quot;map_a4fdb0523e82af01d11dbb9a0f326a95&quot; ></div>
        
</body>
<script>
    
    
            var map_a4fdb0523e82af01d11dbb9a0f326a95 = L.map(
                &quot;map_a4fdb0523e82af01d11dbb9a0f326a95&quot;,
                {
                    center: [-31.598654891752652, 117.491030649332],
                    crs: L.CRS.EPSG3857,
                    zoom: 10,
                    zoomControl: true,
                    preferCanvas: false,
                }
            );
            L.control.scale().addTo(map_a4fdb0523e82af01d11dbb9a0f326a95);

            

        
    
            var tile_layer_8568c44cc6731d175d660af37bb0f6dc = L.tileLayer(
                &quot;https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,
                {&quot;attribution&quot;: &quot;Data by \u0026copy; \u003ca target=\&quot;_blank\&quot; href=\&quot;http://openstreetmap.org\&quot;\u003eOpenStreetMap\u003c/a\u003e, under \u003ca target=\&quot;_blank\&quot; href=\&quot;http://www.openstreetmap.org/copyright\&quot;\u003eODbL\u003c/a\u003e.&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 18, &quot;maxZoom&quot;: 18, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            ).addTo(map_a4fdb0523e82af01d11dbb9a0f326a95);
        
    
            map_a4fdb0523e82af01d11dbb9a0f326a95.fitBounds(
                [[-31.6059444159889, 117.47847020738], [-31.5913653675164, 117.503591091284]],
                {}
            );
        
    
        function geo_json_6d53967b35c9c11d9d37838d8c87b514_styler(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.5, &quot;weight&quot;: 2};
            }
        }
        function geo_json_6d53967b35c9c11d9d37838d8c87b514_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_6d53967b35c9c11d9d37838d8c87b514_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_6d53967b35c9c11d9d37838d8c87b514_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_6d53967b35c9c11d9d37838d8c87b514_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        geo_json_6d53967b35c9c11d9d37838d8c87b514.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_6d53967b35c9c11d9d37838d8c87b514_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_6d53967b35c9c11d9d37838d8c87b514 = L.geoJson(null, {
                onEachFeature: geo_json_6d53967b35c9c11d9d37838d8c87b514_onEachFeature,
            
                style: geo_json_6d53967b35c9c11d9d37838d8c87b514_styler,
                pointToLayer: geo_json_6d53967b35c9c11d9d37838d8c87b514_pointToLayer
        });

        function geo_json_6d53967b35c9c11d9d37838d8c87b514_add (data) {
            geo_json_6d53967b35c9c11d9d37838d8c87b514
                .addData(data)
                .addTo(map_a4fdb0523e82af01d11dbb9a0f326a95);
        }
            geo_json_6d53967b35c9c11d9d37838d8c87b514_add({&quot;bbox&quot;: [117.47847020738, -31.6059444159889, 117.503591091284, -31.5913653675164], &quot;features&quot;: [{&quot;bbox&quot;: [117.47847020738, -31.6059444159889, 117.503591091284, -31.5913653675164], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[117.489151504115, -31.5913691802967], [117.489499470537, -31.5913949144415], [117.489615365014, -31.5913854481526], [117.489615459384, -31.5914034922787], [117.489657619992, -31.5914033307159], [117.489678605914, -31.5913852058034], [117.489731259467, -31.5913759817587], [117.489973635662, -31.5913660303011], [117.492492777704, -31.5913653675164], [117.492935748728, -31.5914177927978], [117.493030752605, -31.5914444929719], [117.493515409295, -31.5914065329674], [117.493610127899, -31.5913791003632], [117.494474419548, -31.5913757585272], [117.495064762841, -31.5913915170498], [117.49512790826, -31.5913732278922], [117.496434885437, -31.5913681565962], [117.496645783901, -31.5913853815003], [117.497035721122, -31.5913748430042], [117.498026589895, -31.5913890291704], [117.498838132305, -31.591376841169], [117.499344154973, -31.5913929090814], [117.50116754976, -31.591376747901], [117.501536599318, -31.5914023665439], [117.502021445406, -31.5914004624971], [117.50229558564, -31.5914174295743], [117.502590709364, -31.5914162690549], [117.502759448388, -31.591433649685], [117.502865043578, -31.5914693230885], [117.50301328418, -31.5915950508789], [117.50302406672, -31.591640119606], [117.503130147122, -31.5917660132272], [117.503140929738, -31.5918110819426], [117.503183381403, -31.5918650481782], [117.50324759249, -31.5920452399824], [117.503268769899, -31.5920632010391], [117.503375724342, -31.592351491214], [117.503396901845, -31.5923694522476], [117.503407781696, -31.5924325650195], [117.503536011675, -31.5927568601451], [117.503557189302, -31.5927748211498], [117.5035894411, -31.5928919830685], [117.503591091284, -31.5931987324825], [117.503549609395, -31.5933252072299], [117.503403403038, -31.5935784058691], [117.503372315578, -31.5936777729035], [117.503330445099, -31.5937320712483], [117.503153246693, -31.5941026806936], [117.503027828101, -31.5943016636332], [117.502986248022, -31.5944100941081], [117.502808659299, -31.5947085267423], [117.502787965978, -31.5947807860251], [117.502714812299, -31.5948983628838], [117.502642046015, -31.5950881160209], [117.502589779266, -31.5951695217094], [117.502589973035, -31.5952056098692], [117.502392462562, -31.5957206537923], [117.50233047774, -31.5959554754886], [117.502299291551, -31.5960367981669], [117.502267814829, -31.5960639886026], [117.502226233113, -31.5961724188175], [117.502216128119, -31.5962536586031], [117.502184748113, -31.5962988930961], [117.502174643071, -31.5963801328772], [117.502111979701, -31.5964886459124], [117.502101874578, -31.5965698856862], [117.502049703333, -31.5966693352257], [117.502018807012, -31.5968047900625], [117.501966829094, -31.5969403277201], [117.50194584435, -31.5969584546236], [117.501925343416, -31.5970668019064], [117.501883664116, -31.5971571879255], [117.501863743588, -31.5973737996516], [117.501802240112, -31.5976988414315], [117.501802917312, -31.597825149955], [117.501772117013, -31.5979786487896], [117.50175277649, -31.5983035249162], [117.501711386672, -31.5984480430887], [117.501659117272, -31.5985294483817], [117.5014806465, -31.5986654824489], [117.501459564599, -31.5986655651995], [117.501301981908, -31.5987654281226], [117.501186272891, -31.5988109932312], [117.501081249645, -31.5988835830033], [117.501060167693, -31.5988836656886], [117.500944748155, -31.5989833628014], [117.500756555117, -31.5992728118239], [117.500714584114, -31.5993090652326], [117.500651917128, -31.59941757754], [117.500494814795, -31.5996076598439], [117.50046352934, -31.5996709379839], [117.500369190355, -31.5997705519924], [117.500296029806, -31.5998881274468], [117.500254058349, -31.5999243807054], [117.500212279749, -31.5999967220961], [117.50014932243, -31.6000511019379], [117.500149418863, -31.6000691460107], [117.500107447268, -31.6001053992216], [117.499971521357, -31.6003134424262], [117.499887674163, -31.6004039927908], [117.499772829682, -31.6006119532882], [117.49968898203, -31.600702503523], [117.499657695673, -31.6007657814643], [117.499605230548, -31.6008110977754], [117.499542561287, -31.600919609537], [117.49949009602, -31.6009649258011], [117.49949019233, -31.6009829698733], [117.499353878656, -31.6011188361322], [117.499353974939, -31.6011368802043], [117.499186085226, -31.6012818919287], [117.499186181478, -31.6012999360008], [117.498860893616, -31.601580895595], [117.498860989806, -31.6015989396671], [117.498640632361, -31.6017892666682], [117.49864072851, -31.6018073107403], [117.498483329756, -31.6019432583677], [117.498483425875, -31.6019613024398], [117.498451946064, -31.6019884919423], [117.498430863404, -31.6019885742009], [117.498325930546, -31.6020792058031], [117.498326026635, -31.6020972498753], [117.498158133607, -31.6022422602613], [117.498158229664, -31.6022603043335], [117.498032309529, -31.6023690619796], [117.498032405562, -31.6023871060517], [117.498000829449, -31.6023962513719], [117.497895895718, -31.6024868826242], [117.497895991725, -31.6025049266964], [117.497822537979, -31.6025683685222], [117.497822633973, -31.6025864125944], [117.497675918085, -31.6027493842648], [117.497655219099, -31.6028216426851], [117.497687179264, -31.6028846737362], [117.497750523838, -31.6029024713834], [117.497929776221, -31.6029107950463], [117.498109220733, -31.6029552065982], [117.498193936515, -31.6030270540261], [117.498236198379, -31.6030449336486], [117.498299927513, -31.6031349072983], [117.498300696218, -31.6032792598508], [117.498279805436, -31.6033154302251], [117.498259395042, -31.6034418209392], [117.498124036589, -31.6037581265707], [117.498083023053, -31.6039748197978], [117.498000035086, -31.6042277655291], [117.497969322607, -31.6043993074466], [117.497969802752, -31.6044895277789], [117.497948911577, -31.6045256980964], [117.497918198914, -31.6046972399955], [117.4978661148, -31.6048147318591], [117.497835209887, -31.6049501856025], [117.497793427216, -31.605022526188], [117.497793907204, -31.605112746514], [117.497711301418, -31.6054378682888], [117.497648914839, -31.6056005112902], [117.497649298726, -31.6056726875461], [117.497576322144, -31.605826349545], [117.497513263454, -31.605862684031], [117.497397447891, -31.6058902017035], [117.497365966455, -31.6059173909385], [117.497387145926, -31.6059353529105], [117.497376652109, -31.6059444159889], [117.497281728161, -31.6059357633356], [117.497260548711, -31.605917801346], [117.497217710387, -31.6057916570329], [117.497132705195, -31.6056656768109], [117.497036535458, -31.6054224511159], [117.496962120475, -31.6053054517829], [117.496707970061, -31.6050899069844], [117.496707874273, -31.6050718629163], [117.496601978633, -31.6049820524281], [117.496601882866, -31.6049640083594], [117.496199385679, -31.6046046836002], [117.496030337002, -31.6045331623602], [117.49594571712, -31.604479357583], [117.495840109736, -31.6044436786574], [117.495797752073, -31.6044077541754], [117.495713228031, -31.6043719933135], [117.495564976635, -31.6042462574112], [117.495511838696, -31.6041652635407], [117.495342218204, -31.6039854769234], [117.495342122684, -31.6039674328485], [117.495267997507, -31.6039045646944], [117.495246914405, -31.603904646432], [117.495130527686, -31.6038238975849], [117.495109444602, -31.6038239792997], [117.495066992033, -31.6037700104898], [117.494360280081, -31.6036915473297], [117.494180835857, -31.6036471305129], [117.494096313109, -31.6036113685635], [117.493821281332, -31.6034319875536], [117.493736758913, -31.6033962253618], [117.493494066593, -31.6033520520096], [117.493314433162, -31.603271545798], [117.493113907267, -31.6032272088798], [117.492944863394, -31.6031556834914], [117.492817700535, -31.6030298629633], [117.49267909405, -31.6027326641456], [117.492645997347, -31.6024531027689], [117.492666415139, -31.6023267128566], [117.492665560156, -31.602164316072], [117.492644382444, -31.6021463532886], [117.492602406987, -31.6021826040613], [117.492581799173, -31.6022729057923], [117.492573489854, -31.6026969824766], [117.492605731536, -31.6028141470933], [117.492626909393, -31.6028321098798], [117.492669645137, -31.602940211783], [117.492765135784, -31.6030571324116], [117.492786693825, -31.6031472715078], [117.492745003031, -31.6032376545784], [117.492619075229, -31.6033464069501], [117.492597992245, -31.6033464882492], [117.492566510242, -31.6033736763178], [117.492482273246, -31.6033920455433], [117.492260854329, -31.603383876732], [117.492039530328, -31.6033937516221], [117.490553131531, -31.6033904459056], [117.48996271299, -31.6033746673304], [117.48925647964, -31.6033863963193], [117.489129887293, -31.6033688366391], [117.488992612053, -31.6033242510436], [117.488833876908, -31.6032075695977], [117.488812793943, -31.6032076502718], [117.488706907925, -31.6031178331137], [117.48868582498, -31.6031179137667], [117.488579939185, -31.6030280964998], [117.488558856259, -31.6030281771316], [117.488410616515, -31.6029024327801], [117.488389533618, -31.6029025133837], [117.488135409317, -31.6026869511805], [117.488081996324, -31.6025518218293], [117.488070654954, -31.6023984872629], [117.488038607298, -31.6023174096339], [117.48798566514, -31.6022725007302], [117.487785049744, -31.6022101112924], [117.487531962804, -31.6021930329466], [117.487394690034, -31.6021484456005], [117.487278312198, -31.6020676894859], [117.487257229484, -31.6020677699007], [117.487077228101, -31.6019150784106], [117.487056145421, -31.6019151587919], [117.486854874262, -31.6017264591477], [117.486822921762, -31.6016634252968], [117.486821983073, -31.6014829842482], [117.486883728741, -31.6011940375271], [117.486904717376, -31.6011759130701], [117.486903778547, -31.6009954720099], [117.486628674271, -31.6007980311156], [117.486607591842, -31.6007981114203], [117.486163079776, -31.6004569589391], [117.486141997422, -31.6004570391662], [117.486057293137, -31.6003851835991], [117.485982708482, -31.6002320893763], [117.486024123411, -31.6000875760841], [117.486055606244, -31.6000603896059], [117.486055512528, -31.6000423454946], [117.486495613598, -31.5995354252122], [117.486494957012, -31.5994091164304], [117.486441173167, -31.5992018098312], [117.486366401314, -31.5990126275744], [117.486313368079, -31.5989496738139], [117.486250122037, -31.598949914549], [117.485913559274, -31.5990955508567], [117.485660949236, -31.5991686892809], [117.485492667127, -31.5992415067747], [117.485440008718, -31.5992507291101], [117.485376949628, -31.5992870576453], [117.485145420751, -31.599360114959], [117.485082361471, -31.5993964433502], [117.484998126506, -31.5994148076307], [117.484977137889, -31.5994329317791], [117.484819255622, -31.5994786422031], [117.484756196134, -31.5995149704346], [117.48464038449, -31.5995424765268], [117.484514171822, -31.5995970886674], [117.484367063605, -31.5996878688503], [117.484104142967, -31.5998061544752], [117.484009599625, -31.5998696683449], [117.483946446248, -31.599887952063], [117.483851902716, -31.5999514658171], [117.483778254764, -31.5999788114342], [117.48361024944, -31.6001057588212], [117.483589167157, -31.6001058386262], [117.483463232754, -31.6002145820906], [117.483442150447, -31.6002146618716], [117.483379183123, -31.6002690335474], [117.483358100803, -31.6002691133147], [117.483295133394, -31.6003234849494], [117.483274051061, -31.600323564703], [117.483169105196, -31.6004141840087], [117.483148022842, -31.6004142637416], [117.483085055213, -31.6004686352738], [117.483063972847, -31.600468714993], [117.482980015878, -31.6005412103077], [117.48288537792, -31.600586679235], [117.482832904676, -31.6006319887404], [117.4826646177, -31.6007048025408], [117.482148795605, -31.60084208387], [117.481685724623, -31.6009881864717], [117.481570095929, -31.6010517780423], [117.48142279689, -31.6011064666247], [117.481391312347, -31.6011336519739], [117.481244013072, -31.6011883403519], [117.481149466376, -31.6012518521246], [117.48098108421, -31.6013066196034], [117.480949599471, -31.6013338048448], [117.480676082182, -31.6014431010977], [117.480592029811, -31.6014975507376], [117.480265943948, -31.6016341105711], [117.480139818444, -31.6017067625481], [117.479718905343, -31.6018526995916], [117.479487180677, -31.6018896584823], [117.479371179623, -31.6018810715848], [117.479286664005, -31.6018452997537], [117.479180696186, -31.6017374304485], [117.479105567334, -31.6014760673881], [117.479083560967, -31.6012957051928], [117.479062293659, -31.6012596960008], [117.479040564532, -31.6011334661713], [117.479008617477, -31.6010704303054], [117.478986703758, -31.6009081122068], [117.479006677925, -31.600691503625], [117.478911299123, -31.6005926166005], [117.478879260011, -31.6005115365652], [117.478771632573, -31.6000788725388], [117.478739686068, -31.6000158365898], [117.478728175755, -31.5998264127143], [117.478759291414, -31.5997270514869], [117.478801178892, -31.5996727610745], [117.478811396882, -31.599609567107], [117.478768770966, -31.5995195044677], [117.478631044773, -31.5993846869417], [117.478630952491, -31.5993666428088], [117.478556749828, -31.5992857206302], [117.478470853123, -31.5989792862085], [117.47847020738, -31.5988529772662], [117.478501507514, -31.5987897043569], [117.47856447672, -31.5987353350543], [117.478669702094, -31.5986988518861], [117.478785699144, -31.5987074394647], [117.47880687344, -31.5987254045897], [117.478859624568, -31.5987342291182], [117.478965034509, -31.5987338339758], [117.479070352085, -31.5987153946128], [117.479091341701, -31.598697271423], [117.479459952793, -31.5986327329118], [117.479744420557, -31.5986045982953], [117.480039660492, -31.5986215337687], [117.480081639294, -31.5985852870707], [117.480090930712, -31.5983416516831], [117.480048304164, -31.5982515894593], [117.480047748861, -31.5981433246645], [117.480099389051, -31.5979356190903], [117.480273630729, -31.5969695844049], [117.48030483643, -31.5968882669181], [117.480314775333, -31.5967709404089], [117.48035619758, -31.5966264288038], [117.480479259432, -31.5959583201105], [117.480582350103, -31.5955068202122], [117.480603338711, -31.595488696775], [117.480644945281, -31.5953802733353], [117.480707910962, -31.5953259029827], [117.480707818294, -31.5953078588438], [117.480728899505, -31.595307779525], [117.480770783889, -31.5952534884604], [117.480791865088, -31.5952534091313], [117.480970267175, -31.5950993595157], [117.480991348338, -31.595099280154], [117.481022738265, -31.5950540507582], [117.481043819418, -31.595053971388], [117.481096290447, -31.5950086626006], [117.481096197706, -31.5949906184618], [117.481117278844, -31.5949905390796], [117.48153713791, -31.5946461120816], [117.481524972997, -31.5943303793741], [117.481556269584, -31.5942671057073], [117.481566299513, -31.5941678232112], [117.481513086633, -31.5940687790701], [117.481491541635, -31.5939786378133], [117.481467769287, -31.5934554371552], [117.481434802495, -31.5931939162414], [117.481400444021, -31.5926617331444], [117.481409824419, -31.5924361416208], [117.481472416477, -31.5923095943095], [117.48149349701, -31.5923095148712], [117.481566954, -31.5922460823018], [117.481661677074, -31.5922186585151], [117.481767079636, -31.5922182611338], [117.482409616786, -31.592134636581], [117.482493938751, -31.5921343181901], [117.482557087211, -31.5921160352175], [117.482904775609, -31.5920876548827], [117.483020578591, -31.5920601504193], [117.483104434894, -31.5919696109167], [117.483208998919, -31.5918068150709], [117.483250973459, -31.591770567336], [117.483272053866, -31.5917704876055], [117.483335015603, -31.5917161159672], [117.483377176391, -31.5917159564753], [117.483450817995, -31.5916886111182], [117.484431102611, -31.5916939205167], [117.484631412976, -31.591702183158], [117.48471582795, -31.5917199074432], [117.484810642984, -31.5917105254725], [117.48492672532, -31.591737151704], [117.484968979583, -31.5917550358244], [117.48506435559, -31.5918539184891], [117.485075690523, -31.5920072536375], [117.485055731992, -31.5922238633023], [117.485024812399, -31.5923593143591], [117.484995108009, -31.5927293391627], [117.484933455195, -31.5930363294896], [117.48493429646, -31.5931987266941], [117.484944977036, -31.5932257528891], [117.484966057765, -31.5932256728759], [117.485082422536, -31.5933064313394], [117.485082516039, -31.5933244754723], [117.485283765363, -31.5935131783748], [117.485336514121, -31.5935220002596], [117.485451850251, -31.5934042729302], [117.485472650283, -31.5933500604379], [117.485504131039, -31.5933228740881], [117.485524931022, -31.5932686615872], [117.485566905303, -31.5932324131022], [117.485587705231, -31.5931782005907], [117.485619185896, -31.5931510142129], [117.485681866318, -31.5930425090382], [117.485680181211, -31.592717714653], [117.485636803087, -31.592483301175], [117.485602327458, -31.5919330752515], [117.485622939882, -31.5918427744553], [117.485706793453, -31.5917522332691], [117.485769941007, -31.5917339487163], [117.485801421139, -31.5917067622928], [117.485875155658, -31.5916974596811], [117.487140072318, -31.5917106878619], [117.487350782189, -31.5916918398543], [117.487435197644, -31.5917095623378], [117.487814644466, -31.5917081142338], [117.487898777898, -31.59167170402], [117.487972135949, -31.5915902236806], [117.487972041895, -31.5915721795506], [117.488087466385, -31.5914724939941], [117.488192679814, -31.5914360030611], [117.488308574491, -31.5914265379557], [117.488340053775, -31.591399350914], [117.488445361165, -31.5913809039037], [117.488455854243, -31.5913718415462], [117.489151504115, -31.5913691802967]], [[117.491116366038, -31.6026213336253], [117.490894865763, -31.6025784813581], [117.490878074177, -31.6026222494965], [117.490742212982, -31.6026810429645], [117.490538191769, -31.6027255301626], [117.490521934531, -31.6028712713026], [117.490624212651, -31.6029000142785], [117.490846248469, -31.603044840046], [117.490998978161, -31.6029568458932], [117.491117436413, -31.6028252797052], [117.491116366038, -31.6026213336253]], [[117.493411942297, -31.592502378779], [117.493189927808, -31.5923575570168], [117.493088120881, -31.5924162215166], [117.493133593224, -31.5945866616285], [117.493252959177, -31.5946299045221], [117.493542442384, -31.5946579223883], [117.493677906054, -31.5945262880553], [117.493709639774, -31.5940891288077], [117.493706643328, -31.5935209927267], [117.493756548308, -31.593302281537], [117.493703954282, -31.5930111269697], [117.493617245701, -31.5927055362745], [117.493411942297, -31.592502378779]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;GM_TYPE&quot;: &quot;Unknown Area Type&quot;, &quot;KML_FOLDER&quot;: &quot;Field Boundary&quot;, &quot;LAYER&quot;: &quot;Field Boundary\u003cBR/\u003e\u003ca href=\&quot;http://www.pct-ag.com\&quot;\u003ewww.pct-ag.com\u003c/a\u003e&quot;, &quot;NAME&quot;: &quot;BF 66&quot;, &quot;_a_href&quot;: &quot;\&quot;http://www.pct-ag.com\&quot;\u003ewww.pct-ag.com\u003c/a\u003e&quot;, &quot;tessellate&quot;: &quot;true&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_6d53967b35c9c11d9d37838d8c87b514.bindTooltip(
    function(layer){
    let div = L.DomUtil.create('div');
    
    let handleObject = feature=>typeof(feature)=='object' ? JSON.stringify(feature) : feature;
    let fields = [&quot;NAME&quot;, &quot;LAYER&quot;, &quot;GM_TYPE&quot;, &quot;_a_href&quot;, &quot;KML_FOLDER&quot;, &quot;tessellate&quot;];
    let aliases = [&quot;NAME&quot;, &quot;LAYER&quot;, &quot;GM_TYPE&quot;, &quot;_a_href&quot;, &quot;KML_FOLDER&quot;, &quot;tessellate&quot;];
    let table = '<table>' +
        String(
        fields.map(
        (v,i)=>
        `<tr>
            <th>${aliases[i]}</th>
            
            <td>${handleObject(layer.feature.properties[v])}</td>
        </tr>`).join(''))
    +'</table>';
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
    
        function geo_json_08fa5410c39ac9a29948b6742b0138f4_styler(feature) {
            switch(feature.id) {
                default:
                    return {&quot;color&quot;: &quot;red&quot;, &quot;fillColor&quot;: &quot;red&quot;, &quot;fillOpacity&quot;: 0.5, &quot;weight&quot;: 2};
            }
        }
        function geo_json_08fa5410c39ac9a29948b6742b0138f4_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_08fa5410c39ac9a29948b6742b0138f4_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_08fa5410c39ac9a29948b6742b0138f4_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_08fa5410c39ac9a29948b6742b0138f4_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        geo_json_08fa5410c39ac9a29948b6742b0138f4.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_08fa5410c39ac9a29948b6742b0138f4_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_08fa5410c39ac9a29948b6742b0138f4 = L.geoJson(null, {
                onEachFeature: geo_json_08fa5410c39ac9a29948b6742b0138f4_onEachFeature,
            
                style: geo_json_08fa5410c39ac9a29948b6742b0138f4_styler,
                pointToLayer: geo_json_08fa5410c39ac9a29948b6742b0138f4_pointToLayer
        });

        function geo_json_08fa5410c39ac9a29948b6742b0138f4_add (data) {
            geo_json_08fa5410c39ac9a29948b6742b0138f4
                .addData(data)
                .addTo(map_a4fdb0523e82af01d11dbb9a0f326a95);
        }
            geo_json_08fa5410c39ac9a29948b6742b0138f4_add({&quot;bbox&quot;: [117.4917210815142, -31.59702623146842, 117.4917210815142, -31.59702623146842], &quot;features&quot;: [{&quot;bbox&quot;: [117.4917210815142, -31.59702623146842, 117.4917210815142, -31.59702623146842], &quot;geometry&quot;: {&quot;coordinates&quot;: [117.4917210815142, -31.59702623146842], &quot;type&quot;: &quot;Point&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;red&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_08fa5410c39ac9a29948b6742b0138f4.bindTooltip(
    function(layer){
    let div = L.DomUtil.create('div');
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
</script>
</html>" style="position:absolute;width:100%;height:100%;left:0;top:0;border:none !important;" allowfullscreen="" webkitallowfullscreen="" mozallowfullscreen=""></iframe></div></div>
</div>
</div>
<p>Now we have our field’s centroid, we’re in a position to make a series of API calls to the open-meteo API as HTTP requests. We’ll loop over a sequence of years, and for each year request the daily sum of precipitation (in mm) for the field. We’ll then sum the daily precipitation values over the growing season and convert the response to a pandas <code>DataFrame</code>.</p>
<p>Note how we use Python f-strings or formatted strings to update the query parameters and URL for each iteration of our loop. f-strings have the structure <code>f"my_string_with_a_{value}"</code> - we can pass values from our program into the <code>{}</code> within the string and these values will be converted to a string object. This only works if our string is prefixed with <code>f</code>. You can read up on Python string formatting <a href="https://realpython.com/python-f-strings/" target="_blank">here</a>.</p>
<p>This might take a few seconds to run.</p>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1950</span>, <span class="dv">2020</span>, <span class="dv">1</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># change this for different climate variables</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># look up variables on the open-meteo docs: https://open-meteo.com/en/docs/historical-weather-api#api-documentation</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>climate_variable <span class="op">=</span> <span class="st">"rain_sum"</span> </span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for each year we'll create a DataFrame - store them in this list</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> []</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> years:</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> year <span class="kw">in</span> [<span class="dv">1950</span>, <span class="dv">1960</span>, <span class="dv">1970</span>, <span class="dv">1980</span>, <span class="dv">1990</span>, <span class="dv">2000</span>, <span class="dv">2010</span>]:</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"getting data for year </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    start_date <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-06-01"</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    end_date <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-10-31"</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">=</span> {</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"latitude"</span>: latitude,</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"longitude"</span>: longitude,</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"start_date"</span>: start_date,</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"end_date"</span>: end_date,</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"daily"</span>: climate_variable,</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timezone"</span>: <span class="st">"auto"</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> requests.get(<span class="st">"https://archive-api.open-meteo.com/v1/archive"</span>, params<span class="op">=</span>payload)</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get the JSON response from open-meteo and process</span></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>    json_response <span class="op">=</span> r.json()</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>    clim_var <span class="op">=</span> json_response[<span class="st">"daily"</span>][climate_variable]</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># compute sum of growing seaon precipitation</span></span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># change this for variables where the mean is a more sensible summary (e.g. temp)</span></span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>    clim_var <span class="op">=</span> <span class="bu">sum</span>(clim_var)</span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>    tmp_df <span class="op">=</span> pd.DataFrame({<span class="st">"year"</span>: [year], climate_variable: [clim_var]})</span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a>    dfs.append(tmp_df)</span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a><span class="co"># concatenate each year's DataFrame into one DataFrame object</span></span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a>df_years <span class="op">=</span> pd.concat(dfs, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a>df_years.head()</span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>getting data for year 1950
getting data for year 1960
getting data for year 1970
getting data for year 1980
getting data for year 1990
getting data for year 2000
getting data for year 2010</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="66">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>year</th>
      <th>rain_sum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1950</td>
      <td>154.2</td>
    </tr>
    <tr>
      <th>0</th>
      <td>1951</td>
      <td>126.4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>1952</td>
      <td>144.7</td>
    </tr>
    <tr>
      <th>0</th>
      <td>1953</td>
      <td>144.6</td>
    </tr>
    <tr>
      <th>0</th>
      <td>1954</td>
      <td>149.4</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>px.scatter(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    df_years,</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"year"</span>,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"rain_sum"</span>,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    trendline<span class="op">=</span><span class="st">"ols"</span>,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"rain_sum"</span>: <span class="st">"growing season rainfall (mm)"</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab-6_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="recap-quiz-3" class="level4">
<h4 class="anchored" data-anchor-id="recap-quiz-3">Recap quiz</h4>
<p><strong>Can you generate a short program that will visualise trends in growing season temperature since 1950?</strong></p>
<p><strong>Remember the open-meteo historical weather API is embedded earlier in this notebook to help you identify what query parameters you need. Or, you can find it <a href="https://open-meteo.com/en/docs/historical-weather-api" target="_blank">here</a>.</strong></p>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">## ADD CODE HERE ##</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<details>
<summary>
<b>answer</b>
</summary>
<div class="sourceCode" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1950</span>, <span class="dv">2020</span>, <span class="dv">1</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># change this for different climate variables</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co"># look up variables on the open-meteo docs: https://open-meteo.com/en/docs/historical-weather-api#api-documentation</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>climate_variable <span class="op">=</span> <span class="st">"temperature_2m_max"</span> </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for each year we'll create a DataFrame - store them in this list</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> []</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> years:</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> year <span class="kw">in</span> [<span class="dv">1950</span>, <span class="dv">1960</span>, <span class="dv">1970</span>, <span class="dv">1980</span>, <span class="dv">1990</span>, <span class="dv">2000</span>, <span class="dv">2010</span>]:</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"getting data for year </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>    start_date <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-06-01"</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>    end_date <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-10-31"</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">=</span> {</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"latitude"</span>: latitude,</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"longitude"</span>: longitude,</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"start_date"</span>: start_date,</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"end_date"</span>: end_date,</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"daily"</span>: climate_variable,</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timezone"</span>: <span class="st">"auto"</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> requests.get(<span class="st">"https://archive-api.open-meteo.com/v1/archive"</span>, params<span class="op">=</span>payload)</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get the JSON response from open-meteo and process</span></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>    json_response <span class="op">=</span> r.json()</span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>    clim_var <span class="op">=</span> json_response[<span class="st">"daily"</span>][climate_variable]</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># !!!!!!! </span><span class="al">NOTE</span><span class="co"> WE CHANGE THIS TO THE MEAN !!!!!!!!</span></span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># change this for variables where the mean is a more sensible summary (e.g. temp)</span></span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>    clim_var <span class="op">=</span> <span class="bu">sum</span>(clim_var) <span class="op">/</span> <span class="bu">len</span>(clim_var)</span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>    tmp_df <span class="op">=</span> pd.DataFrame({<span class="st">"year"</span>: [year], climate_variable: [clim_var]})</span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>    dfs.append(tmp_df)</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a><span class="co"># concatenate each year's DataFrame into one DataFrame object</span></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>df_years <span class="op">=</span> pd.concat(dfs, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>px.scatter(</span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a>    df_years,</span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"year"</span>,</span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"temperature_2m_max"</span>,</span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a>    trendline<span class="op">=</span><span class="st">"ols"</span>,</span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{</span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">"temperature_2m_max"</span>: <span class="st">"growing season daily maximum T °C"</span></span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><strong>Can you write a program that will retrieve annual summer (December to February) average daily maximum temperature from the open-meteo API?</strong></p>
<p><strong>This is a trickier task as you’ll need to account for the fact summer months span two calendar years and compute the mean of temperature values.</strong></p>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">## ADD CODE HERE ##</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<details>
<summary>
<b>answer</b>
</summary>
<div class="sourceCode" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1950</span>, <span class="dv">2020</span>, <span class="dv">1</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co"># change this for different climate variables</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># look up variables on the open-meteo docs: https://open-meteo.com/en/docs/historical-weather-api#api-documentation</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>climate_variable <span class="op">=</span> <span class="st">"temperature_2m_max"</span> </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for each year we'll create a DataFrame - store them in this list</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> []</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> years:</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> year <span class="kw">in</span> [<span class="dv">1950</span>, <span class="dv">1960</span>, <span class="dv">1970</span>, <span class="dv">1980</span>, <span class="dv">1990</span>, <span class="dv">2000</span>, <span class="dv">2010</span>]:</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"getting data for year </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># !!!!!! </span><span class="al">NOTE</span><span class="co"> HOW WE HAVE UPDATED THE DATES</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># !!!!!! </span><span class="al">NOTE</span><span class="co"> THE CHANGE TO </span><span class="re">END</span><span class="co"> DATE YEAR</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    start_date <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-12-01"</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    end_date <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>year<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">-02-28"</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">=</span> {</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"latitude"</span>: latitude,</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"longitude"</span>: longitude,</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"start_date"</span>: start_date,</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"end_date"</span>: end_date,</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"daily"</span>: climate_variable,</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timezone"</span>: <span class="st">"auto"</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> requests.get(<span class="st">"https://archive-api.open-meteo.com/v1/archive"</span>, params<span class="op">=</span>payload)</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get the JSON response from open-meteo and process</span></span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>    json_response <span class="op">=</span> r.json()</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>    clim_var <span class="op">=</span> json_response[<span class="st">"daily"</span>][climate_variable]</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># !!!!!!! </span><span class="al">NOTE</span><span class="co"> WE CHANGE THIS TO THE MEAN !!!!!!!!</span></span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># change this for variables where the mean is a more sensible summary (e.g. temp)</span></span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>    clim_var <span class="op">=</span> <span class="bu">sum</span>(clim_var) <span class="op">/</span> <span class="bu">len</span>(clim_var)</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>    tmp_df <span class="op">=</span> pd.DataFrame({<span class="st">"year"</span>: [year], climate_variable: [clim_var]})</span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>    dfs.append(tmp_df)</span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a><span class="co"># concatenate each year's DataFrame into one DataFrame object</span></span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>df_years <span class="op">=</span> pd.concat(dfs, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>px.scatter(</span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>    df_years,</span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"year"</span>,</span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"temperature_2m_max"</span>,</span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>    trendline<span class="op">=</span><span class="st">"ols"</span>,</span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{</span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">"temperature_2m_max"</span>: <span class="st">"summer daily maximum T °C"</span></span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><strong>Can you use the open-meteo weather forecast API to get a 7-day hourly forecast for evapotranspiration and vapour pressure deficit for the field?</strong></p>
<p><strong>The open-meteo weather forecast API can be found <a href="https://open-meteo.com/en/docs" target="_blank">here</a>.</strong></p>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">## ADD CODE HERE ##</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<details>
<summary>
<b>answer</b>
</summary>
<div class="sourceCode" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>payload <span class="op">=</span> {</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"latitude"</span>: latitude,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"longitude"</span>: longitude,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"hourly"</span>: <span class="st">"evapotranspiration,vapor_pressure_deficit"</span>, <span class="co"># note we can add two comma separated values here</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"timezone"</span>: <span class="st">"auto"</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">"https://api.open-meteo.com/v1/forecast"</span>, params<span class="op">=</span>payload)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co"># get the JSON response from open-meteo and process</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>json_response <span class="op">=</span> r.json()</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>hours <span class="op">=</span> json_response[<span class="st">"hourly"</span>][<span class="st">"time"</span>]  <span class="co"># note change in keys in response (hourly not daily)</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>evap <span class="op">=</span> json_response[<span class="st">"hourly"</span>][<span class="st">"evapotranspiration"</span>]</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>vpd <span class="op">=</span> json_response[<span class="st">"hourly"</span>][<span class="st">"vapor_pressure_deficit"</span>]</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>df_forecast <span class="op">=</span> pd.DataFrame({<span class="st">"date_time"</span>: hours, <span class="st">"evap"</span>: evap, <span class="st">"vpd"</span>: vpd})</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="co"># example line chart for evapotranspiration forecast</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>px.line(</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>    df_forecast,</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"date_time"</span>,</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"evap"</span>,</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"evap"</span>: <span class="st">"evapotranspiration (mm)"</span>,</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date_time"</span>: <span class="st">"date and time"</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./lab-5-self-guided.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Week 5 (self-guided)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./lab-6-self-guided.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-title">Week 6 (self-guided)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>